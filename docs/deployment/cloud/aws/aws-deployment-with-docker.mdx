---
title: 'Docker Image'
description: 'Deploying Xyne on AWS'
icon: 'docker'
---

<Tip>We recommend using EC2 Instance for the deployment as it is the simplest to set-up.</Tip>

If you want to deploy Xyne on AWS instead of your local machine, this guide will give you a detailed guide to do so.
Follow the steps listed below to get started : 

<Note>This guide focuses on deploying the application using docker image only</Note>

## Connect to the instance remotely: 
Once you have your instance up and running, you can use your terminal to connect to your instance remotely. 
Use this command to connect to your instance : 

```javascript
ssh -i ~/path/to/your-private-key-file.pem ec2-user@public-ipv4-address [or your-instance-username@public-ipv4-address]
```

## Install the required dependencies : 
Deployment of Xyne on AWS EC2 requires the following dependencies to be installed on the instance:

- [Bun](https://bun.sh/docs/installation)
```javascript
sudo yum update -y && curl -fsSL https://bun.sh/install | bash 
source ~/.bashrc
bun --version
```
- [Docker](https://docs.docker.com/engine/install/) & [Docker Compose](https://docs.docker.com/compose/install/)
```javascript
sudo yum update -y && sudo yum install -y docker && sudo service docker start && sudo usermod -a -G docker $USER
curl -s https://api.github.com/repos/docker/compose/releases/latest | grep browser_download_url  | grep docker-compose-linux-x86_64 | cut -d '"' -f 4 | wget -qi -
chmod +x docker-compose-linux-x86_64 && sudo mv docker-compose-linux-x86_64 /usr/local/bin/docker-compose
docker-compose --version
```
<Warning> Remember to exit out of the instance and login again to be able to use docker properly.</Warning>

- [Vespa CLI](https://docs.vespa.ai/en/build-install-vespa.html)
```javascript
wget https://github.com/vespa-engine/vespa/releases/download/v8.453.24/vespa-cli_8.453.24_linux_amd64.tar.gz [ you can choose a more recent version]
tar -xzf vespa-cli_8.453.24_linux_amd64.tar.gz
sudo mv vespa-cli_8.453.24_linux_amd64/bin/vespa /usr/local/bin/
vespa version
```

Once you have installed the dependencies, you can use the following steps to set up the instance.

<Warning>Ensure you have an instance with enough storage to store the dependencies and run the Xyne Application</Warning>


## Use Docker To Load the Image : 

Use the following docker command to load the image of Xyne.
```javascript
docker load < image-name.tar.gz
```

## Extract the project

To extract the project, you first need to run the container with the loaded image, and then extract the project : 

- Run the docker container with the image :
```javascript
docker run --name your-container-name -p 3000:3000 image-name
```

- Make a directory called ```xyne``` from your root instance, use the following command :
```javascript
sudo mkdir xyne
```

Use ```docker ps -a``` to check the ID of the container.

- Extract the project inside the ```xyne``` folder, use the following command : 
```javascript
docker cp <container:id>:usr/src/app /home/your-instance-username/xyne/search
```
#### You can now remove the container : 

 - Stop the conatiner if not already stopped :
    ```javascript
    docker stop <container_name_or_id>
    ```
 - Remove the container :
    ```javascript
    docker rm <container_name_or_id>
    ```

### Setup Environment variables: 
Inside the ```server``` folder of the ```xyne/search``` folder, create a ```.env``` file using :
```javascript
sudo touch .env
```
In the ```.env``` file, you can paste the following :

```javascript .env file
NOTION_API_KEY=<YOUR_NOTION_SECRET>
ENCRYPTION_KEY=<YOUR_ENCRYPTION_KEY>
# If you wish to execute authorization using Service Account then use :
 SERVICE_ACCOUNT_ENCRYPTION_KEY=<YOUR_SERVICE_ACCOUNT_ENCRYPTION_KEY> 
# If you wish to execute authorization using Oauth then use :   
GOOGLE_CLIENT_ID=<YOUR_GOOGLE_CLIENT_ID>
GOOGLE_CLIENT_SECRET=<YOUR_GOOGLE_CLIENT_SECRET>
GOOGLE_REDIRECT_URI=http://localhost:3000/v1/auth/callback
GOOGLE_PROD_REDIRECT_URI=<YOUR_Public_IPv4_DNS_ADDRESS>/v1/auth/callback
POST_OAUTH_REDIRECT=http://localhost:5173/
POST_OAUTH_PROD_REDIRECT=<YOUR_Public_IPv4_DNS_ADDRESS>
JWT_SECRET=<YOUR_JWT_SECRET>
DATABASE_HOST=xyne-db
VESPA_HOST=vespa
AWS_ACCESS_KEY=<YOUR_AWS_ACCESS_KEY>
AWS_SECRET_KEY=<YOUR_AWS_ACCESS_SECRET>
OPENAI_API_KEY=<YOUR_OPEN_API_KEY>

```

### Set permissions for vespa to run : 

From the root of the instance, use the following commands inside ther `server` directory : 
```javascript
chmod +x ./init-vespa.sh

./init-vespa.sh
```

## Deploy Vespa and Postgres with Docker  :

Navigate to the ```deployment``` folder : 
```javascript 
cd xyne/search/deployment
```
Once inside the ```deployment``` folder, run the following command to run vespa and postgres in docker :
```javascript 
docker-compose -f docker-compose.yml up
```

### Deploy Vespa in your instance : 

Navigate to ```server``` folder and run the following command :

```javascript 
chmod +x ./setup-docker.sh

./setup-docker.sh
```

Your application is now running and will be available in your EC2 Public IPv4 DNS address.


